import{D as de,a as x,g as Me,S as We,d as I,i as k,o as m,c as $,F as Q,r as ie,u as d,w as ze,t as E,b as c,e as U,p as W,f as z,n as me,h as T,j as _e,k as P,v as L,l as A,m as h,q as Ze,Q as He,s as C,x as qe,y as Ye,T as Y,z as Je,A as J,B as fe,C as Ge,E as ge,G as Qe,H as Xe}from"./vendor.04e5d134.js";const je=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const u of i.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&s(u)}).observe(document,{childList:!0,subtree:!0});function a(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerpolicy&&(i.referrerPolicy=n.referrerpolicy),n.crossorigin==="use-credentials"?i.credentials="include":n.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=a(n);fetch(n.href,i)}};je();class ve{constructor(t,a){this.timestamp=Date.now(),this.message=t||"ERROR",this.error=a||"",Object.defineProperties(this,{ErrorLog:{value:[],enumerable:!1,writable:!0}})}}class et extends de{constructor(){super("LogData");this.version(1).stores({errorlog:"++id, timestamp, message, error"}),this.log=this.table("errorlog")}newError(t,a){X.log.put(new ve(t,a)).catch(s=>{console.log(s)})}newLog(t){X.log.put(new ve(t)).catch(a=>{console.log(a)})}getAll(t){X.log.reverse().toArray().then(a=>a.forEach(s=>t.push(s)))}}var X=new et;const f=new Map;f.set(0,"Unbekannter Fehler");f.set(1,"Keine Verbindung zum Scanner");f.set(2,"Keine Verbindung zum Bezahl Service");f.set(3,"Keine Verbindung zum Bezahl Terminal");f.set(4,"Initialisierung des Bezahl Terminal fehlgeschlagen");f.set(5,"Das Bezahl Terminal mach gerade ein Software-Update");f.set(6,"Scanner nicht angeschlossen");f.set(7,"Bankomatzahlung fehlgeschlagen! Bitte noch einmal versuchen");f.set(8,"Keine Verbindung zum Kassen Service");f.set(9,"Fehler bei der Verarbeitung des Boniervorgangs");f.set(10,"Artikel mit diesem Code nicht erfasst");f.set(11,"Kassa nicht angemeldet");f.set(12,"Kassenanmeldung fehlgeschlagen :(");f.set(13,"Kassenanmeldung erfolgreich :)");f.set(14,"Kassenanmeldung auf FinanzOnline noch nicht best\xE4tigt");f.set(15,"Kassenabschluss des Bezahl Terminals erforderlich");f.set(16,"Fehler beim Abholen der Kassen-Konfiguration");f.set(17,"Senden der Rechnung an den Drucker fehlgeschlagen");f.set(18,"Fehler beim Abholen der Unternehmensdaten");f.set(19,"Maximale Artikelanzahl pro Bon erreicht!");f.set(20,"Keine Verbindung zum RFID-Modul");f.set(21,"RFID-Modul nicht angeschlossen");f.set(22,"Fehler beim Abholen der Kundendaten");f.set(23,"RFID nicht angelegt");f.set(24,"Kontostand konnte nicht eruiert werden");f.set(25,"Fehler beim Abholen des Kontostands");f.set(26,"Keine Verbindung zum RFID-Service");f.set(901,"Rechnung wird gedruckt");const o={E_UNKNOWN:0,E_NETWORK:1,E_UNAVAILABLE:2,E_NOTFOUND:3,E_UNAUTHORIZED:4,E_DEPENDENCY:5,E_CONFLICT:6,E_MAX_ARTICLE_COUNT:7,E_SERVER_ERROR:8},B=new Map;B.set("Network",o.E_NETWORK);B.set("code 500",o.E_SERVER_ERROR);B.set("code 503",o.E_UNAVAILABLE);B.set("code 404",o.E_NOTFOUND);B.set("not found",o.E_NOTFOUND);B.set("code 401",o.E_UNAUTHORIZED);B.set("code 424",o.E_DEPENDENCY);B.set("code 409",o.E_CONFLICT);B.set("code 418",o.E_MAX_ARTICLE_COUNT);function b(e,t,a){var s=t.message?t.message:"no message in error";B.forEach((n,i)=>{s.includes(i)&&(e.error={nr:a.get(n),err:t},X.newError(f.get(e.error.nr),JSON.stringify(t)),clearTimeout(e.errorIdleTimer),ye(e),e.errorIdleTimer=setTimeout(()=>{e.error=null},e.error_idle_timeout,e))})}function R(e,t,a){e.devices[t]&&a==0&&console.log(`${t} working again`),e.devices[t]==0&&a>0&&console.log(`${t} out of order`),e.devices[t]=a}function tt(e,t){return new Promise((a,s)=>{if(t.mms.receipt&&t.mms.receipt.itemlist&&t.mms.receipt.itemlist.length>18){s({message:"code 418 max items reached"});return}Z("/add_receipt_item",{receiptcode:t.mms.receipt?t.mms.receipt.code:"",register_id:t.registerID,item_code:e},t).then(n=>{a(n.data)}).catch(n=>{s(n),console.dir(n)})})}function nt(e,t){return new Promise((a,s)=>{Z("/add_receipt_item",{receiptcode:t.mms.receipt?t.mms.receipt.code:"",register_id:t.registerID,item_code:e.product.code,qty:-e.qty},t).then(n=>{let i=n.data;i.itemlist?a(i):a(null)}).catch(n=>{s(n),console.dir(n)})})}function at(e,t){return new Promise((a,s)=>{Z("/payment",{receipt_code:t.mms.receipt.code,starttime:parseInt(`${new Date().getTime()/1e3}`),type:t.invoice.payment_type,status:"success",data:"",ptdata:e,amount:t.mms.receipt.total.price},t).then(n=>{a(n)}).catch(n=>{s(n)})})}function st(e,t){return new Promise((a,s)=>{var n={receipt_code:t.mms.receipt.code,starttime:parseInt(`${new Date().getTime()/1e3}`),type:t.invoice.payment_type,status:"success",data:"",customer_account:e,amount:t.mms.receipt.total.price};Z("/payment",n,t).then(i=>{a(i)}).catch(i=>{s(i)})})}function it(e,t){return new Promise((a,s)=>{Z("/end_of_day",e,t).then(n=>{a(n)}).catch(n=>{console.dir(n),s(n)})})}function ot(e,t){return new Promise((a,s)=>{Z("/receipt",{register_id:t.registerID,receipt_type:e},t).then(n=>{a(n)}).catch(n=>{s(n)})})}function j(e,t){return new Promise((a,s)=>{_t("/receipt",{code:t.mms.receipt.code,status:e},t).then(n=>{a(n)}).catch(n=>{s(n)})})}function ct(e,t){return new Promise((a,s)=>{Z("/enroll",e,t).then(n=>{a(n.data)}).catch(n=>{console.dir(n),s(n)})})}function ye(e){if(!!e.registerID)return new Promise(async(t,a)=>{var s=null;try{s=`url: ${e.error.err.config.url}, message: ${e.error.err.message}`}catch{}try{var n=await Z("/register_status",{register_id:e.registerID,devices:e.devices,error:s},e);t(n)}catch(i){console.log(`could not send error '${s}' to mms
 ${i}`)}})}function rt(e){return new Promise((t,a)=>{var s=[`register_id=${e.registerID}`];ee("/register_config",s,e).then(n=>{e.buttons=n.buttons?n.buttons:null,e.mms.url=n.api_url?n.api_url:e.mms.url,e.invoice.remote=n.public_api_url?`${n.public_api_url}/invoice_pdf?code=`:e.invoice.remote,t(n)}).catch(n=>{b(e,n,new Map([[o.E_NETWORK,8],[o.E_UNAVAILABLE,16],[o.E_NOTFOUND,16],[o.E_UNAUTHORIZED,11]])),a(n)})})}function lt(e,t){return new Promise((a,s)=>{var n=[`id=${t}`];ee("/company",n,e).then(i=>{e.CompanyData.Name=i.name?i.name:null,e.CompanyData.Address=i.address?i.address:null,a(i)}).catch(i=>{b(e,i,new Map([[o.E_NETWORK,8],[o.E_UNAVAILABLE,18],[o.E_NOTFOUND,18],[o.E_UNAUTHORIZED,11]])),s(i)})})}function ut(e,t){return new Promise((a,s)=>{var n=[`key_uid=${t}`];ee("/customer",n,e).then(i=>{e.customer.account=i,e.customer.idleTimer&&clearTimeout(e.customer.idleTimer),e.customer.idleTimer=setTimeout(()=>{e.customer.account=null,e.customer.creditLines=null,e.customer.balance=null,e.customer.paying=!1},e.customer.idleTimeout,e),e.customer.countdown_interval&&clearInterval(e.customer.countdown_interval),a(i)}).catch(i=>{e.customer.account=null,e.customer.creditLines=null,e.customer.balance=null,e.customer.paying=!1,b(e,i,new Map([[o.E_NETWORK,8],[o.E_UNAVAILABLE,22],[o.E_NOTFOUND,23],[o.E_UNAUTHORIZED,11]])),s(i)})})}function Ee(e,t){return new Promise((a,s)=>{var n=[`customer_id=${t}`];ee("/customer_account_balance",n,e).then(i=>{e.customer.balance=i.balance/100,a(i)}).catch(i=>{e.customer.balance=null,b(e,i,new Map([[o.E_NETWORK,8],[o.E_UNAVAILABLE,25],[o.E_NOTFOUND,24],[o.E_UNAUTHORIZED,11],[o.E_SERVER_ERROR,0]])),s(i)})})}function dt(e,t){return new Promise((a,s)=>{var n=[`customer_id=${t}`];ee("/customer_account",n,e).then(i=>{e.customer.creditLines=i,a(i)}).catch(i=>{e.customer.creditLines=null,b(e,i,new Map([[o.E_NETWORK,8],[o.E_UNAVAILABLE,25],[o.E_NOTFOUND,24],[o.E_UNAUTHORIZED,11],[o.E_SERVER_ERROR,0]])),s(i)})})}function mt(e,t){return new Promise((a,s)=>{Z("/credit_account_line",t,e).then(async n=>{await Ee(e,e.customer.account.id),a(n)}).catch(n=>{e.customer.balance=null,b(e,n,new Map([[o.E_NETWORK,8],[o.E_UNAVAILABLE,26],[o.E_NOTFOUND,27],[o.E_UNAUTHORIZED,11],[o.E_SERVER_ERROR,0]])),s(n)})})}function ee(e,t,a){return new Promise((s,n)=>{let i="";if(t.length>0)for(var u in t)i+=i.length>0?"&":"?",i+=t[u];te(a).catch(g=>n(g)).then(g=>{x.get(`${a.mms.url}${e}${i}`,{auth:a.auth}).then(r=>{s(r.data)}).catch(r=>{var l=r.message?r.message:"no message in error",_=l.includes("Network")||l.includes("code 500");_&&a.failover_url?x.get(`${a.failover_url}${e}${i}`,{auth:a.auth}).then(w=>{s(w.data)}).catch(w=>{n(w)}):n(r)})})})}function Z(e,t,a){return new Promise(async(s,n)=>{a.registerID.length>0&&await te(a),x.post(`${a.mms.url}${e}`,t,{auth:a.auth}).then(i=>{s(i)}).catch(i=>{var u=i.message?i.message:"no message in error",g=u.includes("Network")||u.includes("code 500");g&&a.failover_url?x.post(`${a.failover_url}${e}`,t,{auth:a.auth}).then(r=>{s(r)}).catch(r=>{n(r)}):n(i)})})}function _t(e,t,a){return new Promise((s,n)=>{te(a).catch(i=>n(i)).then(i=>{x.patch(`${a.mms.url}${e}`,t,{auth:a.auth}).then(u=>{s(u)}).catch(u=>{var g=u.message?u.message:"no message in error",r=g.includes("Network")||g.includes("code 500");r&&a.failover_url?x.post(`${a.failover_url}${e}`,t,{auth:a.auth}).then(l=>{s(l)}).catch(l=>{n(l)}):n(u)})})})}const pt=2;class ht{constructor(t,a){this.id=1,this.privateKey=t||null,this.publicKey=a||null,Object.defineProperties(this,{KeyStore:{value:[],enumerable:!1,writable:!0}})}generate(){return console.log("generating new keypair"),new Promise(async t=>{const{publicKey:a,privateKey:s}=await Me("ES256");this.id=1,this.privateKey=s,this.publicKey=a,t()})}}class be{constructor(t,a){this.id=1,this.num=t||"",this.name=a||"",Object.defineProperties(this,{Register:{value:[],enumerable:!1,writable:!0}})}}class we{constructor(t,a,s){this.id=1,this.num=t||"",this.name=a||"",this.addr=s||new Array,Object.defineProperties(this,{Company:{value:[],enumerable:!1,writable:!0}})}}class ft extends de{constructor(){super("RegisterData");this.version(pt).stores({keys:"++id, privateKey, publicKey",register:"++id, num, name",company:"++id, num, name, addr"}),this.keys=this.table("keys"),this.register=this.table("register"),this.company=this.table("company")}setRegisterID(t,a){let s=new be(t,a);F.register.put(s)}getRegister(){return new Promise((t,a)=>{let s=new be;F.register.get(1).catch(n=>a(n)).then(n=>{n?(s.num=n?n.num:"0",s.name=n?n.name:"",t(s)):a(new Error("register not found"))})})}async setCompanyID(t,a,s){let n=new we(t,a,s);await F.company.put(n)}getCompany(){return new Promise((t,a)=>{let s=new we;F.company.get(1).catch(n=>a(n)).then(n=>{n?(s.num=n?n.num:"0",s.name=n?n.name:"",s.addr=n?n.addr:Array(),t(s)):a(n)})})}getKeyPair(){return new Promise((t,a)=>{F.keys.get(1).catch(s=>a(s)).then(s=>{if(s)t(s);else{let n=new ht;n.generate().catch(i=>a(i)).then(()=>{F.keys.put(n),t(n)})}})})}}var F=new ft;function te(e){return new Promise(async(t,a)=>{await F.getRegister().catch(s=>a(s)).then(async s=>{e.registerID=s?s.num:"",e.auth.username=s?s.num:"not defined",await F.getKeyPair().catch(n=>a(n)).then(n=>{n?(e.setPublicKey(n.publicKey),gt(n,e.registerID).then(i=>{e.auth.password=i,t(!0)}).catch(i=>a(i))):t(!1)})})})}function gt(e,t){return new Promise((a,s)=>{new We({"urn:example:claim":!0}).setProtectedHeader({alg:"ES256",kid:t}).setIssuedAt().setIssuer("bezahl.online").setAudience("greisslomat.at").setExpirationTime(new Date().getTime()/1e3+30).sign(e.privateKey).catch(n=>s(n)).then(n=>a(n||""))})}function oe(e){e.idleTimer&&clearTimeout(e.idleTimer),e.idleTimer=setTimeout(()=>{vt(e)},e.idle_timeout,e)}function vt(e){Ne(e),e.mms.receipt=null}function De(e,t){oe(t),t.loading=!0,tt(e,t).then(a=>{t.mms.receipt=a,t.loading=!1}).catch(a=>{t.loading=!1,a.message.includes("code 404")&&(a.message=`${a.message} - EAN: '${e}'`),b(t,a,new Map([[o.E_NETWORK,8],[o.E_UNAVAILABLE,9],[o.E_NOTFOUND,10],[o.E_UNAUTHORIZED,11],[o.E_DEPENDENCY,14],[o.E_MAX_ARTICLE_COUNT,19]]))})}function yt(e,t){t.loading=!0,nt(e,t).then(a=>{t.mms.receipt=a,t.loading=!1}).catch(a=>{t.loading=!1,b(t,a,new Map([[o.E_NETWORK,8],[o.E_UNAVAILABLE,9],[o.E_NOTFOUND,9],[o.E_UNAUTHORIZED,11]]))})}function ce(e){e.mms.receipt=null,e.invoice.receiptCode=null,clearTimeout(e.invoice.idleTimer),oe(e)}function Ne(e){return new Promise((t,a)=>{e.loading=!0,e.mms.receipt||t("OK"),j("cancelled",e).catch(s=>{e.loading=!1,b(e,s,new Map([[o.E_NETWORK,8],[o.E_UNAVAILABLE,9],[o.E_NOTFOUND,9],[o.E_UNAUTHORIZED,11]])),a(s)}).then(()=>{e.loading=!1,t("OK")})})}var S=(e,t)=>{for(const[a,s]of t)e[a]=s;return e};const Et={class:"articles"},bt=["onClick"],wt=I({setup(e){const t=k("store");function a(s){De(s,t)}return(s,n)=>(m(),$("div",Et,[(m(!0),$(Q,null,ie(d(t).buttons,i=>(m(),$("button",{class:"buttons",onClick:ze(u=>a(i.article),["stop"])},E(i.name),9,bt))),256))]))}});var Dt=S(wt,[["__scopeId","data-v-29c2c263"]]),Nt="/assets/Scan.f5d7f3ce.svg";const pe=e=>(W("data-v-7fc22cac"),e=e(),z(),e),Tt={key:0,class:"receipt"},$t={class:"receiptitems"},At=["onClick"],Ot={class:"prodName"},Ct={class:"footer"},It={key:0,class:"totals"},Rt=pe(()=>c("div",null,"Ihr Grei\xDFlomat PREIS:",-1)),kt=pe(()=>c("div",null,"EUR",-1)),Ut={key:1,class:"receipt"},Pt=pe(()=>c("div",{class:"noreceipt"},[c("div",{class:"please"},"Bitte Ware scannen!"),c("img",{class:"scann",src:Nt})],-1)),Lt=[Pt],St=I({emits:["itemstorno"],setup(e,{emit:t}){const a=k("store");return(s,n)=>d(a).mms.receipt?(m(),$("div",Tt,[c("div",$t,[(m(!0),$(Q,null,ie(d(a).mms.receipt.itemlist,(i,u)=>(m(),$("div",{class:"items_grid item",key:u},[i.qty>0?(m(),$(Q,{key:0},[c("div",{class:"ximg",onClick:g=>t("itemstorno",i)},null,8,At),c("div",{class:me([i.qty>1?"qtymore":""])},E(i.qty),3),c("div",Ot,E(i.product.name),1),c("div",null,E((i.price/100).toFixed(2)),1),c("div",null,E((i.total/100).toFixed(2)),1)],64)):U("",!0)]))),128))]),c("div",Ct,[d(a).mms.receipt.total.price?(m(),$("div",It,[Rt,kt,c("div",null,E((d(a).mms.receipt.total.price/100).toFixed(2)),1)])):U("",!0)])])):(m(),$("div",Ut,Lt))}});var Kt=S(St,[["__scopeId","data-v-7fc22cac"]]);const xt=I({emits:["newbcode"],setup(e,{emit:t}){new Map().set(o.E_NETWORK,1),T("");const s=500,n=1e4,i=2e3;let u=s,g="",r=new Date,l=!1;const _=k("store");function w(p){if(p.pt.busy||p.invoice.receiptCode){console.log("payment in progress - no scanning"),setTimeout(O=>{w(O)},1e3,p);return}x.get(p.gm65Url+"/read").then(async O=>{R(p,"scanner",0),l=!1,O.data.payload.length>0&&(g==O.data.payload&&(l=!0,r.getTime()+i<new Date().getTime()&&(l=!1,r=new Date)),l||(g=O.data.payload,r=new Date,O.data.payload.length==36?ct({tan:O.data.payload,public_key:JSON.stringify(p.auth.publicKey)},p).then(V=>{F.setRegisterID(V.id,V.name),te(p).then(G=>{p.error={nr:13,err:null},lt(p,V.company_id).then(M=>{F.setCompanyID(M.id,M.name,M.address)}).catch(M=>{b(p,M,new Map([[o.E_NETWORK,8],[o.E_UNAVAILABLE,13],[o.E_NOTFOUND,12],[o.E_DEPENDENCY,14]]))})})}).catch(V=>{b(p,V,new Map([[o.E_NETWORK,8],[o.E_UNAVAILABLE,13],[o.E_NOTFOUND,12],[o.E_DEPENDENCY,14]]))}):De(g,p))),await v(u),w(p),u=s}).catch(async O=>{p.devices.scanner||(R(p,"scanner",1),b(p,O,new Map([[o.E_NETWORK,1],[o.E_NOTFOUND,6]]))),u<=n&&(u*=2),await v(u),w(p)})}function v(p){return new Promise(O=>{setTimeout(O,p)})}return w(_),console.log("listening to scanner"),(p,O)=>null}}),Bt=I({setup(e){const t=k("store"),a=500,s=1e4;let n=a;function i(r){x.get(r.rfidURL).then(async l=>{R(r,"rfid",0),r.loading=!0;var _=l.data;if(console.log(`keyUid: '${_}'`),_&&_>0){r.error=null;try{await ut(r,_),console.log(`customer ID: ${r.customer.account.id}`),r.customer.account&&r.customer.account.type!="admin"&&(await Ee(r,r.customer.account.id),r.customer.account.type!="admin"&&(r.customer.countdown=5,r.mms.receipt&&r.customer.balance*100>=r.mms.receipt.total.price&&(r.customer.countdown_interval=setInterval(()=>{console.log(r.customer.countdown),r.customer.countdown>0?r.customer.countdown--:clearInterval(r.customer.countdown_interval)},1e3))),await dt(r,r.customer.account.id))}catch{console.log(`no customer found for key uid "${_}"`)}}else n=a,r.customer.account=null;r.loading=!1,i(r)}).catch(async l=>{r.loading=!1,r.devices.rfid||(R(r,"rfid",1),r.customer.account=null,r.error||b(r,l,new Map([[o.E_NETWORK,26],[o.E_NOTFOUND,21]]))),n=s,await u(n),i(r)})}function u(r){return new Promise(l=>{setTimeout(l,r)})}async function g(){for(;!t.registerID;)await u(100);console.log("listening to RFID"),i(t)}return g(),(r,l)=>null}});const Ft={class:"modal",role:"dialog","aria-labelledby":"modalTitle","aria-describedby":"modalDescription"},Vt={class:"modal-header",id:"modalTitle"},Mt={class:"modal-body",id:"modalDescription"},Wt={class:"modal-footer"},K={emits:["close"],setup(e,{emit:t}){return(a,s)=>(m(),$("div",{class:"modal-backdrop",onClick:s[0]||(s[0]=n=>t("close"))},[c("div",Ft,[c("header",Vt,[_e(a.$slots,"header")]),c("section",Mt,[_e(a.$slots,"body")]),c("footer",Wt,[_e(a.$slots,"footer")])])]))}},y={Pending:"pending",Success:"success",Timeout:"timeout",NeedEndOfDay:"need_end_of_day",Abort:"abort"};function zt(e){return new Promise((t,a)=>{if(!(e.mms.receipt&&e.mms.receipt.total.price)){a("no amount available");return}H("/authorise",{amount:e.mms.receipt.total.price,receipt_code:e.mms.receipt.code},e.pt.url).then(s=>{t(s.data)}).catch(s=>{a(s)})})}function Zt(e){return new Promise((t,a)=>{H("/authorise_completion",{receipt_code:e.mms.receipt.code},e.pt.url).then(s=>{t(s.data)}).catch(s=>{a(s)})})}function Ht(e,t){return new Promise((a,s)=>{H("/display_text",{lines:e},t.pt.url).then(()=>{a("OK")}).catch(n=>{s(n)})})}function qt(e){return new Promise((t,a)=>{H("/register",null,e.pt.url).then(()=>{t("register started")}).catch(s=>{a(s)})})}function Yt(e){return new Promise((t,a)=>{H("/register_completion",null,e.pt.url).then(s=>{t(s.data)}).catch(s=>{a(s)})})}function Jt(e){return new Promise((t,a)=>{H("/abort",null,e.pt.url).then(s=>{t(s.data)}).catch(s=>{a(s)})})}function Gt(e){return new Promise((t,a)=>{H("/endofday",null,e.pt.url).then(s=>{t("end of day started")}).catch(s=>{a(s)})})}function Qt(e){return new Promise((t,a)=>{H("/endofday_completion",null,e.pt.url).then(s=>{t(s.data)}).catch(s=>{a(s)})})}function H(e,t,a){return new Promise((s,n)=>{x.post(`${a}${e}`,t).then(i=>{s(i)}).catch(i=>{n(i)})})}function ne(e){en(e).then(()=>{R(e,"pt",0);let t=[e.CompanyData.Name,e.CompanyData.Address[0],e.CompanyData.Address[1]];nn(t,e)}).catch(t=>{R(e,"pt",1),b(e,t,new Map([[o.E_NETWORK,2],[o.E_UNAVAILABLE,3]]))})}function Te(e){return new Promise((t,a)=>{if(e.pt.out_of_order){a(y.NeedEndOfDay);return}e.pt.payment.state=y.Pending,e.pt.payment.message="EC Zahlung gestartet..",e.pt.payment.info=null,e.pt.payment.transactionData=null;function s(n){Zt(n).then(i=>{Xt(i,n),i.transaction.result==y.NeedEndOfDay&&(n.error={nr:15,err:null}),i.transaction.result==y.Pending?s(n):t(i)}).catch(i=>{q(n),a(i)})}zt(e).then(n=>{s(e)}).catch(n=>{q(e),a(n)})})}function Xt(e,t){let a=e.transaction;switch(t.pt.payment.state=a.result,a.data&&a.data.info&&(t.pt.payment.info=a.data.info),a.result){case y.Pending:a.data&&!t.pt.payment.transactionData&&(t.pt.payment.transactionData=a.data);break;case y.Abort:t.pt.payment.message="Zahlung abgebrochen",t.pt.payment.transactionData=null,q(t);break;case y.Success:t.pt.payment.message="Zahlung erfolgreich",q(t);break;case y.NeedEndOfDay:t.pt.payment.message="Tagesabschluss notwendig",q(t);break}}function q(e){setTimeout(function(t){t.pt.payment.message=null,t.pt.payment.info=null},2e3,e)}function jt(e){e.pt.payment.message="Zahlung wird abgebrochen",Jt(e).then(()=>R(e,"pt",0)).catch(t=>{b(e,t,new Map([[o.E_NETWORK,2],[o.E_UNAVAILABLE,3]]))})}function en(e){return new Promise((t,a)=>{e.pt.payment.state=y.Pending;function s(n){Yt(n).then(i=>{R(n,"pt",0),tn(i,n),i.transaction.result==y.Pending?s(n):t(i)}).catch(i=>{R(n,"pt",1),a(i)})}qt(e).then(n=>{s(e)}).catch(n=>{a(n)})})}function tn(e,t){e&&e.message.length>0&&(t.pt.register.message=e.message);let a=e.transaction;switch(t.pt.register.state=a.result,a.data&&a.data.info&&(t.pt.payment.info=a.data.info),a.result){case y.Pending:a.data&&!t.pt.register.transactionData&&(t.pt.register.transactionData=a.data);break;case y.Abort:t.pt.register.transactionData=null,q(t);break;case y.Success:q(t);break}}function nn(e,t){Ht(e,t).then(()=>R(t,"pt",0)).catch(a=>{R(t,"pt",1),b(t,a,new Map([[o.E_NETWORK,2],[o.E_UNAVAILABLE,3]]))})}const he={Ec:"ec",Bluecode:"bluecode",Credit:"credit",Cash:"cash",Bill:"bill",Rksv:"rksv"};const $e=e=>(W("data-v-6a00afda"),e=e(),z(),e),an=$e(()=>c("div",{class:"header"},"Bitte w\xE4hlen Sie eine Zahlungsart",-1)),sn=$e(()=>c("div",{class:"kundenkonto"},null,-1)),on=I({props:{isModalVisible:Boolean,receipt:Object,payName:String},emits:["success","abort","close","pending","need_eod"],setup(e,{emit:t}){const s=T(e.payName);console.log(s.value),T(!1),T(""),T(!1);const n=k("store");ne(n);function i(){n.pt.busy=!0,s.value="Bankomat-Zahlung",n.invoice.payment_type=he.Ec,Te(n).then(u=>{if(R(n,"pt",0),u.transaction.result)switch(u.transaction.result){case y.Success:t("success",u);break;case y.Abort:t("abort");break;case y.NeedEndOfDay:t("need_eod")}n.pt.busy=!1,ne(n)}).catch(u=>{n.devices.pt||(R(n,"pt",1),u==y.NeedEndOfDay?n.error={nr:5,err:null}:b(n,u,new Map([[o.E_NETWORK,2],[o.E_UNAVAILABLE,3],[o.E_CONFLICT,7],[o.E_UNAUTHORIZED,11],[o.E_DEPENDENCY,14]]))),ne(n),n.pt.busy=!1})}return(u,g)=>P((m(),A(K,null,{header:h(()=>[an]),body:h(()=>[c("div",{class:"payments"},[sn,c("div",{class:"bankomat",onClick:i})])]),footer:h(()=>[c("button",{class:"buttonAbort",onClick:g[0]||(g[0]=r=>t("close"))},"abbrechen ")]),_:1},512)),[[L,e.isModalVisible]])}});var cn=S(on,[["__scopeId","data-v-6a00afda"]]);const rn=e=>(W("data-v-67635a5a"),e=e(),z(),e),ln=rn(()=>c("div",{class:"header"},"Bon stornieren",-1)),un={class:"body"},dn={props:{isModalVisible:Boolean},emits:["close","storno"],setup(e,{emit:t}){return(a,s)=>P((m(),A(K,{onClose:s[2]||(s[2]=n=>t("close"))},{header:h(()=>[ln]),body:h(()=>[c("div",un,[c("button",{class:"button back",onClick:s[0]||(s[0]=n=>t("close"))},"zur\xFCck"),c("button",{class:"button yes",onClick:s[1]||(s[1]=n=>t("storno"))},"JA stornieren")])]),_:1},512)),[[L,e.isModalVisible]])}};var mn=S(dn,[["__scopeId","data-v-67635a5a"]]);const Ae=e=>(W("data-v-576f4d79"),e=e(),z(),e),_n=Ae(()=>c("p",{class:"error_header"},"ACHTUNG",-1)),pn={class:"error"},hn=Ae(()=>c("button",{class:"buttonOK"},"OK ",-1)),fn=I({setup(e){const t=k("store");function a(n){n.error=null,clearTimeout(n.errorIdleTimer)}function s(){if(!t.error)return"";let n=f.get(t.error.nr);var i=n||"Unbekannter Fehler";return i}return(n,i)=>P((m(),A(K,{onClick:i[0]||(i[0]=u=>a(d(t)))},{header:h(()=>[_n]),body:h(()=>[c("div",pn,E(s()),1)]),footer:h(()=>[hn]),_:1},512)),[[L,!!d(t).error]])}});var gn=S(fn,[["__scopeId","data-v-576f4d79"]]);function Oe(e){return e.invoice.receiptCode?`${e.invoice.remote}${e.invoice.receiptCode}`:""}function vn(e){return e.invoice.receiptCode?`${e.invoice.local}${e.invoice.receiptCode}#toolbar=0&navpanes=0&scrollbar=0`:""}function yn(e){return new Promise((t,a)=>{En("/print",{pdf_url:Oe(e)},e.printUrl).then(()=>{t("OK")}).catch(s=>{a(s),console.dir(s)})})}function En(e,t,a){return new Promise((s,n)=>{x.post(`${a}${e}`,t).then(i=>{console.dir(i),s(i)}).catch(i=>{console.dir(i),n(i)})})}function bn(e,t,a,s,n,i){const u=Ze("qrcode-vue");return m(),A(u,{value:a.content,size:n.size,level:"H"},null,8,["value","size"])}const wn={data(){return{value:"",size:300}},components:{QrcodeVue:He},props:{content:{type:String,default:""}}};var Ce=S(wn,[["render",bn]]);const Ie=e=>(W("data-v-1a38ba86"),e=e(),z(),e),Dn=Ie(()=>c("div",{class:"header"},"Rechnung",-1)),Nn={key:0,class:"pdf",id:"pdfdiv"},Tn=["src"],$n={class:"invoice_qr"},An={class:"buttons"},On=Ie(()=>c("template",null,null,-1)),Cn=I({setup(e){const t=k("store"),a=T(!1);function s(){yn(t).catch(u=>{t.error={nr:17,err:null}}).then(()=>{ce(t)})}function n(){a.value=!0}function i(){a.value=!1}return(u,g)=>P((m(),A(K,null,{header:h(()=>[Dn]),body:h(()=>[(m(),$("div",Nn,[c("embed",{src:d(vn)(d(t))},null,8,Tn),P(C(K,null,{body:h(()=>[c("div",$n,[C(Ce,{content:d(Oe)(d(t))},null,8,["content"])])]),footer:h(()=>[c("div",{class:"buttons"},[c("button",{onClick:i},"Schlie\xDFen")])]),_:1},512),[[L,a.value]])]))]),footer:h(()=>[c("div",An,[c("button",{onClick:s},"Drucken"),c("button",{onClick:n},"Download"),c("button",{onClick:g[0]||(g[0]=r=>d(ce)(d(t)))},"Schlie\xDFen")])]),default:h(()=>[On]),_:1},512)),[[L,!0]])}});var In=S(Cn,[["__scopeId","data-v-1a38ba86"]]);class Rn{constructor(t){this.timestamp=Date.now(),this.data=t||"",Object.defineProperties(this,{PTEndOfDay:{value:[],enumerable:!1,writable:!0}})}}class kn extends de{constructor(){super("PTData");this.version(1).stores({endofday:"++id, timestamp, data"}),this.endofday=this.table("endofday")}newEndOfDay(t){Re.endofday.put(new Rn(t)).catch(a=>{console.log(a)})}}var Re=new kn,Un="https://register2.bezahl.online",Pn={failover_url:"https://www.greisslomat.at:444",idle_timeout:5*60*1e3,idleTimer:null,loading:!1,buttons:null,heartBeatDuration:5,cronIntervalMinutes:5,auth:{username:"",password:"",publicKey:null},registerID:"",CompanyData:{Name:"Greisslomat e.U.",Address:["Dorf 122","6645 Vorderhornbach"]},devices:{scanner:0,pt:0,rfid:0},error:null,errorIdleTimer:null,error_idle_timeout:8e3,errorList:[],soundEffect:null,mms:{url:Un,receipt:null},invoice:{payment_type:null,remote:"https://rksv.greisslomat.at/invoice_pdf?code=",local:"https://localhost:8050/invoice?code=",receiptCode:null,idleTimer:null,idle_timeout:2*60*1e3},pt:{url:"https://localhost:8060",payment:{state:null,info:null,message:null,transactionData:null},endofday:{state:null,info:null,message:null,transactionData:null},register:{state:null,info:null,message:null,transactionData:null},busy:!1,out_of_order:!1,idleTimer:null,idle_timeout:2*60*1e3},customer:{payment:null,balance:0,account:null,creditLines:null,countdown:5,countdown_interval:null,idleTimer:null,idleTimeout:30*1e3,paying:!1},rfidURL:"https://localhost:8040",gm65Url:"https://localhost:8070",printUrl:"https://localhost:8050",setPublicKey:function(e){Ye(e).then(t=>{this.auth.publicKey=t})}},re=qe(Pn);function le(e){e.pt.busy=!0,Ln(e).then(t=>{if(t.transaction.result)switch(t.transaction.result){case"success":Re.newEndOfDay(JSON.stringify(e.pt.endofday.transactionData)),it(e.pt.endofday.transactionData,e).catch(a=>{e.pt.endofday.transactionData=null}).then(()=>{e.pt.endofday.transactionData=null});break}e.pt.busy=!1}).catch(t=>{b(e,t,new Map([[o.E_NETWORK,2],[o.E_UNAVAILABLE,3]])),e.pt.endofday.message=null,e.pt.busy=!1})}function Ln(e){return new Promise((t,a)=>{function s(n){Qt(n).then(i=>{Sn(i,n),i.transaction.result==y.Pending?s(n):t(i)}).catch(i=>{a(i)})}Gt(e).then(n=>{s(e)}).catch(n=>{a(n)})})}function Sn(e,t){e&&e.message.length>0&&(t.pt.endofday.message=e.message);let a=e.transaction.result;switch(t.pt.endofday.state=a,a){case y.Pending:var s=e.transaction.data;console.dir(s),console.dir(t.pt.endofday),s&&!t.pt.endofday.transactionData&&(t.pt.endofday.transactionData=s,t.pt.endofday.transactionData.register_id=t.registerID);break;case y.Abort:t.pt.endofday.message="Tagesabschluss abgebrochen",t.pt.endofday.transactionData=null,ke(t);break;case y.Success:t.pt.endofday.message="Tagesabschluss erfolgreich",ke(t);break;case y.NeedEndOfDay:t.pt.endofday.message="Sofware-Update steht zur Ver\xFCfgung",t.pt.out_of_order=!0}}function ke(e){setTimeout(function(t){t.pt.endofday.message=null},2e3,e)}const Kn={Start:"start",Standard:"standard",Storno:"storno",Training:"training",Zero:"zero"};const xn={class:"header"},Bn={class:"Vorgang"},Fn=["disabled"],Vn=I({props:{isModalVisible:Boolean,name:String,message:String,result:String,abortBtn:Boolean},emits:["abort"],setup(e,{emit:t}){const a=k("store");return(s,n)=>P((m(),A(K,null,{header:h(()=>[c("div",xn,E(e.name),1)]),body:h(()=>[c("div",Bn,[c("div",{class:me(["info",{success:e.result=="success",abort:e.result=="abort"}])},E(e.message),3)])]),footer:h(()=>[d(a).pt.payment.state=="pending"?(m(),$("button",{key:0,class:"buttonAbort",disabled:e.abortBtn,onClick:n[0]||(n[0]=i=>t("abort"))},"abbrechen",8,Fn)):U("",!0)]),_:1},512)),[[L,e.isModalVisible]])}});var Ue=S(Vn,[["__scopeId","data-v-d4ca34fe"]]);const ae=e=>(W("data-v-52e40262"),e=e(),z(),e),Mn=ae(()=>c("div",{class:"header"},"Administration",-1)),Wn={class:"functions"},zn=J("Fehlerliste "),Zn=ae(()=>c("br",null,null,-1)),Hn=[zn,Zn],qn=J("Reload "),Yn=ae(()=>c("br",null,null,-1)),Jn=[qn,Yn],Gn=J("Tagesabschluss "),Qn=ae(()=>c("br",null,null,-1)),Xn=[Gn,Qn],jn=J("Nullbeleg "),ea=ae(()=>c("br",null,null,-1)),ta=[jn,ea],na={class:"rksv_qr"},aa=I({props:{isModalVisible:Boolean,receipt:Object},emits:["success","abort","close","pending"],setup(e,{emit:t}){function a(){location.reload()}const s=k("store");let n=T(""),i=T(!1);T("Admin Function");let u=T(!1);function g(){X.getAll(s.errorList)}function r(){u.value=!1,s.mms.receipt=null}function l(){ot(Kn.Zero,s).catch(v=>{console.log(v),j("abort",s),s.mms.receipt=null}).then(v=>{s.mms.receipt=v?v.data:null,u.value=!0,j("payed",s)})}function _(){if(!u.value)return"";if(s.mms.receipt){var v=s.mms.receipt.payments[0],p=v.rksv_jwt?v.rksv_jwt:"",O=p.split(".")[1],V=Je(O),G=p.split(".")[2],M=atob(G.replace(/\-/g,"+").replace(/_/g,"/")),ue=btoa(M);return`${V}_${ue}`}}function w(){let v=s.pt.endofday.message;return s.pt.endofday.info&&(v+=`
`+s.pt.endofday.info,console.log(v)),v}return(v,p)=>P((m(),A(K,null,{header:h(()=>[Mn]),body:h(()=>[c("div",Wn,[c("button",{class:"EndOfDay",onClick:g},Hn),c("button",{class:"EndOfDay",onClick:a},Jn),c("button",{class:"EndOfDay",onClick:p[0]||(p[0]=O=>d(le)(d(s)))},Xn),c("button",{onClick:l},ta)])]),footer:h(()=>[c("button",{class:"buttonAbort",onClick:p[1]||(p[1]=O=>t("close"))},"schlie\xDFen"),(m(),A(Y,{to:"#endofbody"},[P(C(K,null,{body:h(()=>[c("div",na,[C(Ce,{content:_()},null,8,["content"])])]),footer:h(()=>[c("div",{class:"buttons",style:{width:"100%"}},[c("button",{onClick:r},"Schlie\xDFen")])]),_:1},512),[[L,d(u)]]),P(C(Ue,{name:"Tagesabschluss",message:w(),result:d(n),abortBtn:d(i)},null,8,["message","result","abortBtn"]),[[L,!!d(s).pt.endofday.message]])]))]),_:1},512)),[[L,e.isModalVisible]])}});var sa=S(aa,[["__scopeId","data-v-52e40262"]]);function Pe(e){return new Date(e*1e3).toLocaleDateString("de-AT")}function Le(e){return new Date(e*1e3).toLocaleTimeString("de-AT")}const Se=e=>(W("data-v-fc69ad5e"),e=e(),z(),e),ia={class:"header"},oa={key:0,class:"Konto"},ca={class:"details"},ra={class:"card"},la={class:"line"},ua=J("Schl\xFCssel Nr. "),da={class:"line"},ma=J("Kontostand: EUR"),_a={class:"bold"},pa={class:"card"},ha={key:0,class:"account"},fa=Se(()=>c("div",{class:"accountHead"},[c("div",{class:"lineDate",style:{"text-align":"center"}},"Datum"),c("div",{class:"lineTime"},"Zeit"),c("div",{class:"lineText"},"Text"),c("div",{class:"lineAmount"},"Betrag")],-1)),ga={class:"lines"},va={class:"lineDate"},ya={class:"lineTime"},Ea={class:"lineText"},ba=Se(()=>c("div",{class:"zheader"},"Zahlung mit Guhaben",-1)),wa={class:"options"},Da=["innerHTML"],Na=["disabled"],Ta=I({props:{isModalVisible:Boolean,name:String,message:String,result:String},emits:["close","payment_success"],setup(e,{emit:t}){function a(_){return n(_)?"nicht gen\xFCgend Guthaben":`<big>${s()}</big> wird automatisch vom Guthaben abgezogen!`}function s(){if(!l.mms.receipt)return"---,--";var _=l.mms.receipt.total.price/100,w="\u20AC "+_.toFixed(2);return w.replace(".",",")}function n(_){return _.customer.balance*100<_.mms.receipt.total.price}function i(_){if(_.customer.countdown_interval&&clearInterval(_.customer.countdown_interval),!_.customer.paying){_.customer.paying=!0,console.dir(_.customer);var w={customer_id:_.customer.account.id,amount:-_.mms.receipt.total.price,text:_.mms.receipt.code,receiptcode:_.mms.receipt.code};mt(_,w).then(v=>{_.invoice.payment_type=he.Credit;var p={customer_id:w.customer_id,amount:-w.amount};_.customer.payment=p,t("payment_success")}).catch(v=>{})}}function u(){if(!l.customer.balance)return"---,--";var _=""+l.customer.balance.toFixed(2);return _.replace(".",",")}function g(){t("close")}function r(){clearInterval(l.customer.countdown_interval),l.customer.account=null}const l=k("store");return fe(()=>{l&&l.customer&&l.customer.countdown==0&&(l.customer.countdown_interval&&clearInterval(l.customer.countdown_interval),l.customer.countdown==0&&l.customer.countdown_interval&&(l.customer.countdown_interval=null,l.customer.countdown=null,i(l)))}),(_,w)=>d(l).customer.account&&d(l).customer.account.type!="admin"?(m(),A(K,{key:0},{header:h(()=>[c("div",ia,E(e.name),1)]),body:h(()=>[d(l).customer.account?(m(),$("div",oa,[c("div",ca,[c("div",ra,[c("div",la,[ua,c("div",null,E(d(l).customer.account.id),1)]),c("div",da,[ma,c("div",_a,E(u()),1)])]),c("div",pa,[c("div",null,E(d(l).customer.account.address.postal.name),1),c("div",null,E(d(l).customer.account.address.postal.street),1),c("div",null,E(d(l).customer.account.address.postal.zip)+" "+E(d(l).customer.account.address.postal.city),1)])]),d(l).customer.creditLines?(m(),$("div",ha,[fa,c("div",ga,[(m(!0),$(Q,null,ie(d(l).customer.creditLines,(v,p)=>(m(),$("div",{class:"accountLine",key:p},[c("div",va,E(d(Pe)(v.timestamp)),1),c("div",ya,E(d(Le)(v.timestamp)),1),c("div",Ea,E(v.text),1),c("div",{class:me(["lineAmount",[v.amount<0?"lineAmountRed":""]])},E((v.amount/100).toFixed(2)),3)]))),128))])])):U("",!0)])):U("",!0),d(l).mms.receipt?(m(),A(K,{key:1},{header:h(()=>[ba]),body:h(()=>[c("div",wa,[c("div",{class:"zahlen",innerHTML:a(d(l))},null,8,Da)])]),footer:h(()=>[n(d(l))?U("",!0):(m(),$("button",{key:0,class:"buttonPay",onClick:w[0]||(w[0]=v=>i(d(l))),disabled:d(l).customer.paying||n(d(l))},E(d(l).customer.countdown),9,Na)),c("button",{class:"buttonCancel",onClick:r},"Abbrechen")]),_:1})):U("",!0)]),footer:h(()=>[c("button",{class:"buttonClose",onClick:g},"schlie\xDFen")]),_:1})):U("",!0)}});var $a=S(Ta,[["__scopeId","data-v-fc69ad5e"]]);const Aa=e=>(W("data-v-77113f3c"),e=e(),z(),e),Oa=Aa(()=>c("div",{class:"header"},"Fehlerliste",-1)),Ca={class:"list"},Ia=["onClick"],Ra={class:"errDate"},ka={class:"errTime"},Ua={class:"errText"},Pa={class:"errorDetail"},La=I({setup(e){const t=T(),a=k("store");function s(n){t.value=JSON.stringify(JSON.parse(n),void 0,3)}return(n,i)=>P((m(),A(K,null,{header:h(()=>[Oa]),body:h(()=>[c("div",Ca,[(m(!0),$(Q,null,ie(d(a).errorList,u=>(m(),$("div",{class:"errorLine",onClick:g=>s(u.error)},[c("div",Ra,E(d(Pe)(u.timestamp/1e3)),1),c("div",ka,E(d(Le)(u.timestamp/1e3)),1),c("div",Ua,E(u.message),1)],8,Ia))),256))]),t.value?(m(),A(K,{key:0},{header:h(()=>[]),body:h(()=>[c("pre",Pa,E(t.value),1)]),footer:h(()=>[c("button",{class:"buttonClose",onClick:i[0]||(i[0]=u=>t.value=null)},"Schlie\xDFen")]),_:1})):U("",!0)]),footer:h(()=>[c("button",{class:"buttonClose",onClick:i[1]||(i[1]=u=>d(a).errorList=[])},"Schlie\xDFen")]),_:1},512)),[[L,!0]])}});var Sa=S(La,[["__scopeId","data-v-77113f3c"]]);const Ke=e=>(W("data-v-36f64f7d"),e=e(),z(),e),Ka={class:"register"},xa={class:"buttons"},Ba=["disabled"],Fa=Ke(()=>c("div",{class:"buttontext"},"Kartenzahlung",-1)),Va=[Fa],Ma={key:0,class:"loading"},Wa=Ke(()=>c("div",{class:"lds-ripple"},[c("div"),c("div")],-1)),za=[Wa],Za=I({setup(e){const t=T(!1),a=T(!1),s=T(!1),n=k("store"),i=T("");T(!1);const u=T(""),g=T(!1);fe(()=>{a.value=!(n.mms.receipt&&n.mms.receipt.itemlist&&n.mms.receipt.itemlist.length>0)});function r(D){yt(D,n)}Ge(n.devices,()=>{l()});function l(){ye(n)}function _(){t.value=!1,oe(n)}function w(){s.value=!1}function v(D){jt(D),g.value=!0}function p(){clearTimeout(n.customer.idleTimer),n.customer.account=null,n.customer.creditLines=null,n.customer.balance=null,n.customer.paying=!1}function O(){at(n.pt.payment.transactionData,n).catch(D=>{b(n,D,new Map([[o.E_NETWORK,8],[o.E_UNAVAILABLE,9],[o.E_NOTFOUND,9],[o.E_CONFLICT,9],[o.E_UNAUTHORIZED,11]]))}).then(D=>{j("payed",n).catch(N=>{console.dir(N),b(n,N,new Map([[o.E_NETWORK,8],[o.E_UNAVAILABLE,9],[o.E_NOTFOUND,9],[o.E_CONFLICT,9],[o.E_UNAUTHORIZED,11]]))}),n.invoice.receiptCode=n.mms.receipt.code,n.mms.receipt=null,n.invoice.idleTimer=setTimeout(N=>{ce(N)},n.invoice.idle_timeout,n),n.pt.payment.transactionData=null,t.value=!1})}function V(){st(n.customer.payment,n).catch(D=>{b(n,D,new Map([[o.E_NETWORK,8],[o.E_UNAVAILABLE,9],[o.E_NOTFOUND,9],[o.E_CONFLICT,9],[o.E_UNAUTHORIZED,11]]))}).then(D=>{j("payed",n).catch(N=>{console.dir(N),b(n,N,new Map([[o.E_NETWORK,8],[o.E_UNAVAILABLE,9],[o.E_NOTFOUND,9],[o.E_CONFLICT,9],[o.E_UNAUTHORIZED,11]]))}),n.invoice.receiptCode=n.mms.receipt.code,n.mms.receipt=null,n.invoice.idleTimer=setTimeout(N=>{ce(N)},n.invoice.idle_timeout,n),n.customer.account=null,n.customer.creditLines=null,n.customer.balance=null,n.customer.paying=!1,t.value=!1})}function G(){oe(n),t.value=!1}function M(){Ne(n).then(()=>{}).catch(D=>{}),n.mms.receipt=null}T(0),T(),T(!1),T(Date.now());function ue(){n.customer.account=null}function xe(){new ge.exports.CronJob("0 0 0 * * *",function(){Be()},null,!0,"Europe/Vienna"),new ge.exports.CronJob("*/15 * * * *",function(){l()},null,!0,"Europe/Vienna")}function Be(){le(n)}xe();function Fe(){clearTimeout(n.idleTimer),n.pt.busy=!0,i.value="Bankomat-Zahlung",n.invoice.payment_type=he.Ec,Te(n).then(D=>{if(D.transaction.result)switch(D.transaction.result){case y.Success:O(),n.devices.pt=0;break;case y.Abort:n.devices.pt=0,G();break;case y.NeedEndOfDay:le(n)}n.pt.busy=!1,ne(n)}).catch(D=>{n.devices.pt=1,D==y.NeedEndOfDay?n.error={nr:5,err:null}:b(n,D,new Map([[o.E_NETWORK,2],[o.E_UNAVAILABLE,3],[o.E_CONFLICT,7],[o.E_UNAUTHORIZED,11],[o.E_DEPENDENCY,14]])),ne(n),n.pt.busy=!1})}function Ve(){if(!n.pt.payment.message)return null;let D=n.pt.payment.message;return n.pt.payment.info&&!n.pt.payment.info.includes(D)&&(D+=`
`+n.pt.payment.info,console.log(D)),D}return(D,N)=>(m(),$("div",Ka,[C(cn,{class:"payment",isModalVisible:t.value,payName:i.value,onClose:_,onSuccess:N[0]||(N[0]=se=>O()),onPending:N[1]||(N[1]=()=>{}),onNeed_eod:N[2]||(N[2]=se=>d(le)(d(n))),onAbort:N[3]||(N[3]=se=>G())},null,8,["isModalVisible","payName"]),C(sa,{class:"admin",isModalVisible:d(n).customer.account&&d(n).customer.account.type=="admin",onClose:ue},null,8,["isModalVisible"]),C(mn,{class:"stornoModal",isModalVisible:s.value,onClose:w,onStorno:M},null,8,["isModalVisible"]),C(Dt),C(Kt,{class:"receipt",onItemstorno:r}),c("div",xa,[c("button",{class:"zahlen",id:"bankomat",onClick:Fe,disabled:a.value},Va,8,Ba)]),C(xt),C(Bt),d(n).loading?(m(),$("div",Ma,za)):U("",!0),(m(),A(Y,{to:"#endofbody"},[P(C(Ue,{onAbort:N[4]||(N[4]=se=>v(d(n))),name:"Bankomat-Zahlung",message:Ve(),result:u.value,abortBtn:g.value},null,8,["message","result","abortBtn"]),[[L,!!d(n).pt.payment.message]])])),(m(),A(Y,{to:"#endofbody"},[d(n).errorList.length>0?(m(),A(Sa,{key:0})):U("",!0)])),(m(),A(Y,{to:"#endofbody"},[P(C($a,{name:"Kundenkonto",result:u.value,onClose:p,onPayment_success:N[5]||(N[5]=se=>V())},null,8,["result"]),[[L,!!d(n).customer.account]])])),(m(),A(Y,{to:"#endofbody"},[C(gn)])),(m(),A(Y,{to:"#endofbody"},[d(n).invoice.receiptCode?(m(),A(In,{key:0,class:"invoice"})):U("",!0)]))]))}});var Ha=S(Za,[["__scopeId","data-v-36f64f7d"]]);const qa=I({setup(e){return Qe("store",re),te(re).then(()=>{rt(re).then(()=>{}).catch(t=>console.dir(t))}).catch(t=>{console.log("register not initialize"),b(re,t,new Map([[o.E_NETWORK,8],[o.E_UNAVAILABLE,11],[o.E_NOTFOUND,11],[o.E_DEPENDENCY,14]]))}),(t,a)=>(m(),A(Ha))}});Xe(qa).mount("#app");
